{% extends 'docs/base_docs.html' %}
{% block title %} PostgreSQL {% endblock %}

{% block doc_content %}
{% include 'docs/postgresql/sub_nav.html' %}
<h1 class="doc-title">SELECT</h1>
<section class="doc-section">
  
<h2 class="doc-header">SELECT 문법</h2>
<h3 class="doc-subheader">기본 팁</h3>
<p>끝에 <code>\G</code>하면 row 단위로 보여줍니다. <code>explain</code>을 사용하면 세부 정보를 보여줍니다.</p>
<pre><code class="language-sql">explain select * from abc\G;</code></pre>

<!-- ############## 선택자 #########################-->
<h2 class="doc-header">선택자 종류</h2>
<pre>=, >, < , > , <=, >=
<>        Not equal. may be written as !=
BETWEEN   Between a certain range(inclusive)
LIKE      Search for a pattern(wildcard: %, _)
IN        To specify multiple possible values for a column
LIMIT     Used to specify the number of records to return
OR, AND, NOT
IS NULL, IS NOT NULL</pre>
<!-- ############## where #########################-->
<h3 class="doc-subheader">WHERE</h3>
  <pre><code class="language-sql">SELECT column1, column2 FROM table_name WHERE condition;

SELECT * FROM Customers WHERE Country='Mexico' AND email IS NOT NULL;
SELECT * FROM Customers WHERE Country='Mexico' AND City='Mexico City';
SELECT * FROM Customers WHERE Country='Mexico' OR Country='USA';
SELECT * FROM Customers WHERE Country='Mexico' OR country LIKE 'United%';
SELECT * FROM Customers WHERE CustomerID < 10;
-- BETWEEN 시작끝 포함
SELECT * FROM Customers WHERE CustomerID BETWEEN 10 AND 19; 
SELECT * FROM Customers WHERE City IN ('Paris','London');</code></pre>
<!-- ############## and, or #########################-->
<h3 class="doc-subheader">AND, OR</h3>
<pre><code class="language-sql">SELECT * FROM customer
  WHERE country = 'Germany' AND (name LIKE 'R%' OR name LIKE 'E%');
SELECT * FROM Customer
  WHERE City = 'Berlin' OR name LIKE 'G%' OR Country = 'Norway'; </code></pre>
<!-- ############## not #########################-->
<h3 class="doc-subheader">NOT</h3>
<pre><code class="language-sql">SELECT * FROM customer WHERE NOT country = 'Germany';
SELECT * FROM customer WHERE country NOT LIKE 'G%';
SELECT * FROM customer WHERE id NOT BETWEEN 10 AND 22;
SELECT * FROM customer WHERE city NOT IN('Paris', 'London');
SELECT country, city FROM customer WHERE city NOT IN('Paris', 'London', 'Tulle') 
  AND country NOT IN('Germany', 'France');</code></pre>
<!-- ############## in #########################-->
<h3 class="doc-subheader">IN</h3>
<pre><code class="language-sql">SELECT * FROM Customers WHERE Country IN ('Germany', 'France', 'UK');</code></pre>
<!-- ############## order by #########################-->
<h3 class="doc-subheader">ORDER BY</h3>
  <pre><code class="language-sql">SELECT column1, ... FROM table_name ORDER BY column1, column2, ... ASC|DESC;
SELECT * FROM Customers ORDER BY Country ASC, CustomerName DESC;  </code></pre>
<!-- ############## null #########################-->
<h3 class="doc-subheader">NULL</h3>
<pre><code class="language-sql">SELECT * FROM Customer WHERE City IS NULL;
  SELECT * FROM Customer WHERE City IS NOT NULL;</code></pre>
<!-- ############## intersect #########################-->
<h3 class="doc-subheader">INTERSECT: 공통으로 적용되는 범위를 보여줌</h3>
<pre><code class="language-sql">select * from employees where office_id >3  
intersect 
select * from employees where salary < 60000;</code></pre>
<!-- ############## except #########################-->
<h3 class="doc-subheader">EXCEPT: 첫번째 쿼리에서 두번째 쿼리의 결과를 제외함</h3>
<pre><code class="language-sql">select * from employees where office_id > 3 
except
select * from employees where salary < 60000;</code></pre>
<!-- ############## limit #########################-->
<h3 class="doc-subheader">LIMIT</h3>
<pre><code class="language-sql">SELECT * FROM Customers LIMIT 5; -- 처음 5개만
SELECT * FROM Customers OFFSET 10 LIMIT 5; -- 11번째부터 5개
SELECT * FROM Customers 5, 10; -- 6번째부터 10개</code></pre>

<!-- ############## sub query        #########################-->
<h2 class="doc-header">Subquery</h2>
<p>Subquery는 쿼리 안에 또 다른 쿼리를 넣는 것입니다.</p>
<pre><code class="language-sql">SELECT column_name(s) FROM table_name
  WHERE column_name operator
  (SELECT column_name FROM table_name WHERE condition);</code></pre>
<h3 class="doc-subheader">Subquery는 SELECT, INSERT, UPDATE, DELETE 문에서 사용 가능</h3>
<pre><code class="language-sql"> SELECT first_name, last_name, salary FROM employees 
  WHERE salary > (SELECT AVG(salary) from employees);
SELECT first_name, last_name FROM employees 
  WHERE employee_id IN
  (SELECT DISTINCT customer_id FROM transactions
  WHERE customer_id IS NOT NULL);</code></pre>
<pre><code class="language-sql">SELECT categoryId, CategoryName,
  (select max(price) from products p where c.CategoryId = p.CategoryID) as CatMax,
  (select avg(price) from products p where c.CategoryId = p.CategoryID) as Cat평균
from categories c;</code></pre>

<!-- ############## exists, any, all #########################-->
<h2 class="doc-header">EXISTS</h2>
<p>if true return value</p>
<p>The EXISTS operator is used to test for the existence of any record in a subquery.</p>
<pre><code class="language-sql">SELECT column_name(s) FROM table_name
  WHERE EXISTS (SELECT column_name(s) FROM table_name WHERE condition);
SELECT SupplierName FROM suppliers
  WHERE EXISTS (SELECT name FROM product 
  WHERE product.supplierID = suppliers.supplierID
  AND Price < 20);</code></pre>

<h2 class="doc-header">ANY</h2>
<pre><code class="language-sql">SELECT ProductName FROM Products
WHERE ProductID = ANY
  (SELECT ProductID FROM OrderDetails
  WHERE Quantity = 10);
SELECT name FROM product
  WHERE id = ANY -- WHERE ID IN 과 동일
  ( SELECT order_id FROM orders WHERE quantity < 4);</code></pre>

<h2 class="doc-header">ALL</h2>
<pre><code class="language-sql">SELECT name FROM product
  WHERE id = ALL 
  ( SELECT order_id FROM orders WHERE quantity < 14);</code></pre>  
</section>

<section class="doc-section">
<h2 class="doc-header">Wildcard</h2>
    <h3 class="doc-subheader">wildcard characters</h3>
    <p>  %	: 0개 이상의 문자<br/>
   _ : 한개의 문자<br/>
   [charlist]	: 안에 들거간 것중 한개(for example, [a-f])(psql 미지원)<br/>
  [^charlist] : 안에 것을 포함하지 않음(for example, [^a-f])(psql 미지원)<br/>
 ^ : not(psql 미지원)<br/>
 {} : 특수 문자(psql 미지원)</p>

  <h3 class="doc-subheader">REGEXP도 가능 : '^' 시작, '$' 끝, 'w' w포함, '^.....$' 5글자, '^.{5}$' 5글자</h3>
  <p>SELECT * FROM Customers
  WHERE CustomerName REGEXP '^a'; -- a로 시작하는 모든 고객을 반환합니다.<br/>
  WHERE CustomerName REGEXP 'a$'; -- a로 끝나는 모든 고객을 반환합니다.<br/>
  WHERE CustomerName REGEXP 'a|b'; -- a 또는 b가 포함된 모든 고객을 반환합니다.<br/>
  WHERE CustomerName REGEXP '^[a-zA-Z]'; -- 알파벳으로 시작하는 모든 고객을 반환합니다.<br/>
  WHERE CustomerName REGEXP '^[0-9]'; -- 숫자로 시작하는 모든 고객을 반환합니다.</p>
<!-- ################ LIKE ################# -->
<h2 class="doc-header">LIKE</h2>
<pre><code class="language-sql">SELECT * FROM Customers
  WHERE CustomerName LIKE 'a%';
SELECT * FROM Customers
  WHERE CustomerName LIKE 'a_%';</code></pre>
    <h3 class="doc-subheader">The _ wildcard represents a single character.</h3>
<pre><code class="language-sql">SELECT * FROM Customers
WHERE city LIKE 'L_nd__';</code></pre>


 <h3 class="doc-subheader">% Wildcard</h3>
<pre><code class="language-sql">-- a 또는 b로 시작하는 모든 고객을 반환합니다:
SELECT * FROM Customers
WHERE CustomerName LIKE 'a%' OR CustomerName LIKE 'b%';

SELECT * FROM Customers WHERE CustomerName LIKE 'b%s';

SELECT * FROM Customers WHERE CustomerName LIKE '%or%';

SELECT * FROM Customers WHERE hire_date LIKE '____-01-__%'; -- 1월 찾기
SELECT * FROM Customers WHERE CustomerName LIKE 'a__%';
SELECT * FROM Customers WHERE CustomerName LIKE '_r%';

/**
 * IN, NOT IN, BETWEEN, NOT BETWEEN
 * IN은 특정 값이 있는지 확인하는 것
 * BETWEEN은 범위에 있는지 확인하는 것
 */</code></pre>

<h2 class="doc-header">IN</h2>
<pre><code class="language-sql">SELECT * FROM Customers
WHERE City IN ('Berlin', 'London');</code></pre>

<h3 class="doc-subheader">NOT IN</h3>
<pre><code class="language-sql">SELECT * FROM Customers
WHERE City NOT IN ('Berlin', 'London');</code></pre>

<h3 class="doc-subheader">IN (SELECT)</h3>
<pre><code class="language-sql">다른 테이블에서 값을 가져오는 경우
SELECT * FROM Customers
WHERE City IN (SELECT City FROM Suppliers);</code></pre>

<h3 class="doc-subheader">NOT IN (SELECT)</h3>
<pre><code class="language-sql">SELECT * FROM Customers
  WHERE City NOT IN (SELECT City FROM Suppliers);
  SELECT * FROM product
  WHERE product.id NOT IN (SELECT quantity FROM order_detail);</code></pre>

<h2 class="doc-header">BETWEEN</h2>
<pre><code class="language-sql">SELECT * FROM Customers WHERE City BETWEEN 'Berlin' AND 'London';</code></pre>

<h3 class="doc-subheader">NOT BETWEEN</h3>
<pre><code class="language-sql">SELECT * FROM Products WHERE Price NOT BETWEEN 10 AND 20;</code></pre>

<h3 class="doc-subheader">BETWEEN with IN</h3>
<pre><code class="language-sql">SELECT * FROM Products WHERE Price BETWEEN 10 AND 20
  AND CategoryID IN (1,2,3);</code></pre>

<h3 class="doc-subheader">BETWEEN Text Values</h3>  
<pre><code class="language-sql">SELECT * FROM Products
  WHERE ProductName BETWEEN 'Carnarvon Tigers' AND 'Mozzarella di Giovanni'
  ORDER BY ProductName;
SELECT * FROM Products
  WHERE ProductName NOT BETWEEN 'Carnarvon Tigers' AND 'Mozzarella di Giovanni'
  ORDER BY ProductName;</code></pre>

<h3 class="doc-subheader">BETWEEN with Date Values</h3>
<pre><code class="language-sql">SELECT * FROM Orders
  WHERE OrderDate BETWEEN '1996-07-04' AND '1996-07-08';</code></pre>

<h2 class="doc-header">Aliases</h2>
<h3 class="doc-subheader">대부분 AS를 빼도 됨</h3>
<pre><code class="language-sql">SELECT ProductName AS Product, Price AS Cost
  FROM Products
  WHERE Price BETWEEN 10 AND 20;
SELECT ProductName Product, Price Cost
  FROM Products
  WHERE Price BETWEEN 10 AND 20;
SELECT ProductName AS "My Great Products" FROM Products; </code></pre>

<h3 class="doc-subheader">Concatenate Columns</h3>
<pre><code class="language-sql">SELECT name , address +',' + city+',' + country address
  FROM customer; // 이거 잘안됨
SELECT name , CONCAT(address,',' ,city,',', country) AS address
  FROM customer;</code></pre>
  
<h3 class="doc-subheader">Alias for Tables</h3>
<pre><code class="language-sql">SELECT o.OrderID, o.OrderDate, c.CustomerName
  FROM Customers AS c, Orders AS o
  WHERE c.CustomerName='Around the Horn' AND c.CustomerID=o.CustomerID;
SELECT c.name, o.price, c.address
  FROM customer c, order_detail o
  WHERE c.id = o.id;</code></pre>
</section>
{% endblock %}